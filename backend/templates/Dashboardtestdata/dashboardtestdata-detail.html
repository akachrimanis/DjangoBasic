<!-- dashboardtestdata-list.html -->

{% extends 'base.html' %} 
{% block content %}  

<div class="container">
    <h1>Dashboard Data</h1>

    <!-- Display Data -->
    <table class="table" id="dashboard-data">
        <thead>
            <tr>
                <th>Name</th>
                <!-- Add other table headers as needed -->
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data will be dynamically inserted here -->
        </tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Fetch CSRF token
        const csrftoken = getCookie('csrftoken');

        // Fetch data from the API
        $.ajax({
            url: '/api/dashboardtestdata/',
            method: 'GET',
            beforeSend: function(xhr) {
                xhr.setRequestHeader('X-CSRFToken', csrftoken);
            },
            success: function(data) {
                // Render fetched data dynamically
                data.forEach(function(item) {
                    $('#dashboard-data tbody').append(`
                        <tr>
                            <td>${item.name}</td>
                            <!-- Add other table cells for additional fields -->
                            <td>
                                <a href="/dashboardtestdata/${item.id}/edit" class="btn btn-sm btn-primary">Edit</a>
                                <button class="btn btn-sm btn-danger" onclick="deleteItem(${item.id})">Delete</button>
                            </td>
                        </tr>
                    `);
                });
            }
        });
    });

    // Function to delete an item
    function deleteItem(id) {
        if (confirm('Are you sure you want to delete this item?')) {
            // Fetch CSRF token
            const csrftoken = getCookie('csrftoken');

            // Send DELETE request
            $.ajax({
                url: `/api/dashboardtestdata/${id}/`,
                method: 'DELETE',
                beforeSend: function(xhr) {
                    xhr.setRequestHeader('X-CSRFToken', csrftoken);
                },
                success: function() {
                    // Reload the page after deletion
                    location.reload();
                }
            });
        }
    }

    // Function to retrieve CSRF token from cookies
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>

{% endblock %}
